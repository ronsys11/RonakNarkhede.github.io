{{/* Hugo Blox: Card View */}}
{{/* This is an overridden file. */}}

{{ $page := . }}
{{ $show_authors := .show_authors | default true }}

<div class="card-simple">

  {{ $image := $page.Params.image }}
  {{ if $image }}
  {{ $resource := $page.Resources.GetMatch (printf "*%s*" $image.filename) }}
  {{ with $resource }}
  {{ $image_args := dict "page" $page "src" . "alt" $image.alt_text "class" "card-img-top" }}
  <a href="{{ $page.RelPermalink }}">
    {{ partial "functions/get_image" $image_args }}
  </a>
  {{ end }}
  {{ end }}

  <div class="card-body">
    <h3 class="card-title mb-2"><a href="{{ $page.RelPermalink }}">{{ $page.Title | emojify }}</a></h3>
    {{ with $page.Params.summary | plainify | emojify }}
      <p class="card-text">{{ . | truncate 280 }}</p>
    {{ end }}
  </div>

  <div class="card-footer">
    <div class="article-metadata">
      {{/* Display authors? */}}
      {{ if and $show_authors $page.Params.authors }}
      <div>
        {{ partial "page_metadata_authors" $page }}
      </div>
      {{ end }}

      {{/* --- START OF THE FIX --- */}}
      {{/* Only display the date section if a date is actually set in the front matter. */}}
      {{ if not .Date.IsZero }}
      <span class="meta-item">
        <span class="article-date">
          {{ $date := $page.Date }}
          {{ if $page.Params.lastmod }}
            {{ $date = $page.Lastmod }}
          {{ end }}
          {{ $date.Format site.Params.locale.date_format }}
        </span>
      </span>
      {{ end }}
      {{/* --- END OF THE FIX --- */}}

      {{ if $page.Params.reading_time }}
      <span class="meta-item">
        <span class="middot-divider"></span>
        <span class="reading-time">
          {{ $page.ReadingTime }} min read
        </span>
      </span>
      {{ end }}
    </div>
  </div>

</div>
